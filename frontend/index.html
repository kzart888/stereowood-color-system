<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>叠雕画颜色管理系统</title>
    
    <!-- 外部依赖库 -->
    <!-- Vue 3.3.4 - 核心框架 (生产版本) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    
    <!-- Element Plus 2.3.14 - UI组件库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/element-plus/2.3.14/index.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/element-plus/2.3.14/index.full.min.js"></script>
    
    <!-- Element Plus Icons - 图标库 -->
    <script src="https://unpkg.com/@element-plus/icons-vue@2.1.0/dist/index.iife.min.js"></script>
    
    <!-- Axios 1.4.0 - HTTP请求库 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    
    <!-- 项目样式文件（模块化） -->
    <link rel="stylesheet" href="css/index.css">
</head>
<body>
        <div id="app">
            <!-- 自定义粘性头部 -->
            <app-header-bar
                :active-tab="activeTab"
                :artworks-view-mode="artworksViewMode"
                :custom-colors-sort-mode="customColorsSortMode"
                :artworks-sort-mode="artworksSortMode"
                :mont-marte-sort-mode="montMarteSortMode"
                :global-search-query="globalSearchQuery"
                :global-search-results="globalSearchResults"
                :show-search-dropdown="showSearchDropdown"
                @update:activetab="val=>setActiveTabPersist(val)"
                @change-artworks-view-mode="setArtworksViewMode"
                @change-sort="setSortMode"
                @global-search-input="handleGlobalSearchInput"
                @open-search-dropdown="openSearchDropdown"
                @close-search-dropdown="closeSearchDropdown"
                @search-select="handleGlobalSearchSelect"
                @add-artwork="$refs.artworksRef && $refs.artworksRef.addArtwork && $refs.artworksRef.addArtwork()"
                @add-custom-color="$refs.customColorsRef && $refs.customColorsRef.openAddDialog && $refs.customColorsRef.openAddDialog()"
                @add-raw-material="$refs.montMarteRef && $refs.montMarteRef.openDialog && $refs.montMarteRef.openDialog()"
                @check-duplicates="$refs.customColorsRef && $refs.customColorsRef.runDuplicateCheck && $refs.customColorsRef.runDuplicateCheck()"
                @show-color-palette="$refs.customColorsRef && $refs.customColorsRef.showColorPalette && $refs.customColorsRef.showColorPalette()"
                @show-help="showHelp"
            ></app-header-bar>

            <!-- Global Help Dialog -->
            <el-dialog v-model="showGlobalHelp" title="使用帮助" width="600px">
                <div v-html="helpContent[activeTab]"></div>
                <template #footer>
                    <el-button @click="showGlobalHelp=false">关闭</el-button>
                </template>
            </el-dialog>

            <!-- 全局搜索栏（仅作用于作品/方案） -->
            <!-- 回退阶段暂时移除搜索功能 UI -->
            <!-- <div class="global-search-bar">
                <el-input v-model.trim="searchQuery" placeholder="搜索作品编号/名称 或 方案名称" clearable size="large" prefix-icon="Search"></el-input>
            </div> -->

            <div class="main-container">
                <div v-show="activeTab==='custom-colors'">
                    <custom-colors-component ref="customColorsRef" :sort-mode="customColorsSortMode"></custom-colors-component>
                </div>
                <div v-show="activeTab==='color-dictionary'">
                    <color-dictionary-component ref="colorDictionaryRef"></color-dictionary-component>
                </div>
                <div v-show="activeTab==='artworks'">
                    <artworks-component ref="artworksRef" :sort-mode="artworksSortMode"></artworks-component>
                </div>
                <div v-show="activeTab==='mont-marte'">
                    <mont-marte-component ref="montMarteRef" :sort-mode="montMarteSortMode"></mont-marte-component>
                </div>
            </div>
        </div>

    <!-- 返回顶部按钮 -->
        <button id="backToTopBtn" aria-label="返回顶部" title="返回顶部">
            <svg viewBox="0 0 24 24" width="22" height="22" aria-hidden="true">
                <!-- 横线 -->
                <rect x="4" y="5" width="16" height="2" rx="1" fill="currentColor" />
                <!-- 向上箭头 -->
                <path d="M12 19c-.55 0-1-.45-1-1V9.83l-3.29 3.3a1 1 0 0 1-1.42-1.42l5-5a1 1 0 0 1 1.42 0l5 5a1 1 0 0 1-1.42 1.42L13 9.83V18c0 .55-.45 1-1 1Z" fill="currentColor" />
            </svg>
        </button>

    <!-- JavaScript模块加载顺序很重要！ -->
    
    <!-- 工具函数库 -->
    <!-- 提供: helpers.formatDate(), helpers.generateColorCode(), helpers.compareNames() -->
    <script src="js/utils/helpers.js"></script>
    
    <!-- 验证函数库 -->
    <!-- 提供: validators.validateColorCode(), validators.validateColorName() -->
    <script src="js/utils/validators.js"></script>

    <!-- 配方解析与哈希 (计算器步骤1) -->
    <script src="js/utils/formula-parser.js"></script>
    <!-- Shared formula utilities -->
    <script src="js/utils/formula-utils.js"></script>
    <!-- Message utility for unified notifications -->
    <script src="js/utils/message.js"></script>
    <!-- Unified color utility toolkit (RGB/HSL/CMYK/LAB conversions + extraction) -->
    <script src="js/utils/color-tools.js"></script>
    <!-- Color distance calculations (Delta E) -->
    <script src="js/utils/colorDistance.js"></script>
    <!-- Color mapping utilities for grid and wheel -->
    <script src="js/utils/colorMapping.js"></script>
    <!-- Pantone color database -->
    <script src="js/data/pantone-colors.js"></script>
    <script src="js/data/pantone-colors-full.js"></script>
    <!-- 计算器状态存储模块 (步骤2) -->
    <script src="js/modules/calc-store.js"></script>
    <!-- 配方查重模块 (顺序 + 倍数不敏感) -->
    <script src="js/modules/duplicate-detector.js"></script>
    
    <!-- API封装库 -->
    <!-- 提供: api.categories, api.customColors, api.artworks, api.montMarteColors -->
    <script src="js/api/api.js"></script>
    
    <!-- Vue组件定义 - 必须在app.js之前加载 -->
    <!-- 头部组件 -->
    <script src="js/components/app-header-bar.js"></script>
    <!-- 配方编辑器组件 -->
    <script src="js/components/formula-editor.js"></script>
    <!-- 冲突解决组件 -->
    <script src="js/components/common/ConflictResolver.js"></script>
    <!-- 通用操作按钮组件 - 暂时禁用 -->
    <!-- <script src="js/components/common/ActionButton.js"></script> -->
    <!-- 自配色组件 mixins -->
    <script src="js/components/custom-colors/mixins/filtering.js"></script>
    <script src="js/components/custom-colors/mixins/pagination.js"></script>
    <script src="js/components/custom-colors/mixins/selection.js"></script>
    <script src="js/components/custom-colors/mixins/media.js"></script>
    <script src="js/components/custom-colors/mixins/duplicates.js"></script>
    <script src="js/components/custom-colors/ListView.js"></script>
    <script src="js/components/custom-colors/dialogs/EditColorDialog.js"></script>
    <script src="js/components/custom-colors/dialogs/DuplicateGroupsDialog.js"></script>
    <script src="js/components/custom-colors/print.js"></script>
    <!-- 定义全局变量: CustomColorsComponent -->
    <script src="js/components/custom-colors.js"></script>
    
    <!-- 定义全局变量: ArtworksComponent -->
    <script src="js/components/artworks.js"></script>
    
    <!-- 定义全局变量: MontMarteComponent -->
    <script src="js/components/mont-marte.js"></script>
    <!-- 分类管理组件 -->
    <script src="js/components/category-manager.js"></script>
    <!-- 高级颜色选择对话框组件 -->
    <script src="js/components/color-palette-dialog.js"></script>
    <!-- 自配色字典模块化依赖 -->
    <script src="js/components/color-dictionary/helpers.js"></script>
    <script src="js/components/color-dictionary/mixins/data.js"></script>
    <script src="js/components/color-dictionary/mixins/interactions.js"></script>
    <script src="js/components/color-dictionary/views/list-view.js"></script>
    <script src="js/components/color-dictionary/views/hsl-view.js"></script>
    <script src="js/components/color-dictionary/views/wheel-view.js"></script>
    <!-- 自配色字典页面组件 -->
    <script src="js/components/color-dictionary.js"></script>
    <!-- 计算器浮层组件 (步骤3) -->
    <script src="js/components/formula-calculator.js"></script>
    <!-- 缩略图预览工具 -->
    <script src="js/utils/thumb-preview.js"></script>
    
    <!-- Configuration helper for test/production mode -->
    <script src="js/utils/config-helper.js"></script>
    
    <!-- Utility Scripts (keeping only essentials for small team) -->
    <script src="js/utils/debounce-throttle.js"></script>
    <script src="js/utils/performance-monitor.js"></script>
    
    <!-- 主应用入口 - 必须最后加载 -->
    <!-- 创建Vue应用实例，注册组件，挂载到#app -->
    <script src="js/app.js"></script>
    <script>
        // 永久显示返回顶部按钮，仅处理点击滚动
        (function(){
            const btn = document.getElementById('backToTopBtn');
            if (!btn) return;
            btn.addEventListener('click', ()=> window.scrollTo(0,0));
        })();
    </script>
</body>
</html>