# Artworks.js 组件重构计划

## 当前状况分析

artworks.js 是项目中最大的组件文件（1021行），包含了多个职责：

### 主要功能模块
1. **作品列表展示** (约200行)
2. **配色方案管理** (约300行) 
3. **层级映射编辑** (约150行)
4. **视图模式切换** (约50行)
5. **作品编辑对话框** (约100行)
6. **工具函数** (约150行)
7. **数据管理和API调用** (约71行)

## 重构方案

### 阶段一：组件拆分

#### 1. ArtworksList.vue
**职责**: 作品列表展示和基本操作
**代码量**: ~200行
**功能**:
- 作品列表渲染
- 排序和搜索过滤  
- 基础的增删操作
- 视图模式切换

#### 2. SchemeEditDialog.vue  
**职责**: 配色方案编辑弹窗
**代码量**: ~300行
**功能**:
- 方案信息编辑
- 缩略图上传管理
- 层级映射编辑器集成
- 表单验证和提交

#### 3. LayerMappingEditor.vue
**职责**: 层级到颜色的映射编辑
**代码量**: ~150行  
**功能**:
- 动态行增删
- 颜色选择和验证
- 重复层级检测
- 映射数据格式化

#### 4. ArtworkEditDialog.vue
**职责**: 作品信息编辑弹窗  
**代码量**: ~100行
**功能**:
- 作品标题编辑
- 格式验证
- 重复检测

#### 5. ViewModeToggle.vue
**职责**: 视图模式切换控件
**代码量**: ~50行
**功能**:
- byLayer/byColor模式切换
- 状态持久化
- 事件通知

### 阶段二：Composables 提取

#### 1. useArtworks.js
**职责**: 作品数据管理逻辑
**功能**:
- 作品数据的CRUD操作
- 排序和过滤逻辑
- API调用封装

#### 2. useSchemes.js  
**职责**: 配色方案管理逻辑
**功能**:
- 方案数据管理
- 层级映射处理
- 验证逻辑

#### 3. useViewMode.js
**职责**: 视图模式状态管理
**功能**:
- 模式切换逻辑
- 本地存储同步
- 状态响应式管理

### 阶段三：重构后的文件结构

```
frontend/js/components/artworks/
├── ArtworksList.vue              # 主列表组件
├── SchemeEditDialog.vue          # 方案编辑弹窗
├── LayerMappingEditor.vue        # 层级映射编辑器
├── ArtworkEditDialog.vue         # 作品编辑弹窗
├── ViewModeToggle.vue            # 视图切换组件
└── ArtworksRefactored.vue        # 重构后的主组件

frontend/js/composables/
├── useArtworks.js                # 作品数据逻辑
├── useSchemes.js                 # 方案管理逻辑
└── useViewMode.js                # 视图模式逻辑
```

## 重构收益

### 1. 可维护性提升
- 单个组件代码量减少80%+
- 职责清晰，便于定位问题
- 组件独立测试

### 2. 可复用性提升  
- LayerMappingEditor可用于其他映射场景
- ViewModeToggle可用于其他列表组件
- 对话框组件可复用

### 3. 开发效率提升
- 并行开发不同功能
- 修改影响范围小
- 新功能扩展容易

### 4. 性能优化
- 组件按需加载
- 更精确的响应式更新
- 减少不必要的重渲染

## 实施步骤

### 第一步：提取独立组件
1. 先提取ViewModeToggle（最简单）
2. 提取ArtworkEditDialog（相对独立）
3. 提取LayerMappingEditor（核心功能）

### 第二步：提取主要对话框
1. 提取SchemeEditDialog  
2. 重构主列表为ArtworksList

### 第三步：Composables重构
1. 创建useArtworks composable
2. 创建useSchemes composable  
3. 创建useViewMode composable

### 第四步：集成测试
1. 创建ArtworksRefactored主组件
2. 集成所有子组件
3. 功能测试和回归验证

## 技术难点

### 1. 状态管理复杂性
- 多个组件间的数据同步
- 编辑状态的传递和管理
- 异步操作的协调

### 2. 事件通信
- 父子组件事件传递
- 兄弟组件间通信
- 全局状态更新通知

### 3. 表单验证
- 跨组件的验证规则
- 复杂的业务验证逻辑
- 错误状态的统一管理

## 建议实施时机

建议在以下情况下启动此重构：
1. 需要大幅修改作品管理功能时
2. 准备引入新的UI框架时  
3. 团队有足够的开发资源时
4. 已完成充分的测试用例编写

## 风险评估

- **高复杂度**: 涉及核心业务逻辑，需要仔细测试
- **向下兼容**: 需要保证API和数据格式兼容
- **开发周期**: 预计需要2-3周的开发和测试时间

---

制定时间: 2025-08-23  
当前状态: 规划阶段
优先级: 中等（待其他重构完成后考虑）