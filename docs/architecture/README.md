# 架构设计文档

本目录包含 STEREOWOOD Color System 的系统架构设计文档和技术决策记录。

## 📋 架构文档索引

### 🏗️ 系统架构
本节将包含系统级架构文档（待创建）：

#### 计划中的文档
- **overview.md** - 系统架构总览
  - 整体架构设计
  - 技术栈选择理由
  - 模块间依赖关系
  - 数据流向分析

- **database-design.md** - 数据库设计文档
  - 数据表结构设计
  - 关系图和约束
  - 索引策略
  - 数据迁移历史

- **api-specification.md** - API接口规范
  - RESTful API 设计
  - 接口文档
  - 错误处理规范
  - 版本控制策略

## 🎯 当前架构概览

### 系统分层架构

```
┌─────────────────────────────────────────────────────────────┐
│                    表示层 (Presentation Layer)               │
├─────────────────────────────────────────────────────────────┤
│  Vue 3 Components + Element Plus UI                        │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │   页面组件   │ │   业务组件   │ │   通用组件   │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
├─────────────────────────────────────────────────────────────┤
│                    业务逻辑层 (Business Logic Layer)          │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  状态管理    │ │  工具模块    │ │  API调用层   │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  计算引擎    │ │  查重算法    │ │  配方解析    │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
├─────────────────────────────────────────────────────────────┤
│                    服务层 (Service Layer)                   │
├─────────────────────────────────────────────────────────────┤
│  Node.js + Express Framework                               │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  路由层      │ │  业务服务    │ │  中间件      │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
├─────────────────────────────────────────────────────────────┤
│                    数据访问层 (Data Access Layer)            │
├─────────────────────────────────────────────────────────────┤
│  SQLite Database + File System                             │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐            │
│  │  关系数据    │ │  文件存储    │ │  历史记录    │            │
│  └─────────────┘ └─────────────┘ └─────────────┘            │
└─────────────────────────────────────────────────────────────┘
```

### 核心模块设计

#### 前端架构模式
```javascript
// 组件层次结构
App (根应用)
├── AppHeaderBar (头部导航)
├── CustomColors (自配颜色管理)
│   ├── ColorList (颜色列表)
│   ├── ColorForm (颜色表单)
│   └── DuplicateDetector (查重检测)
├── Artworks (作品管理)
├── MontMarte (原料管理)
└── FormulaCalculator (配方计算器 - 浮层)

// 功能模块结构
modules/
├── calc-store.js (计算器状态管理)
├── duplicate-detector.js (查重检测算法)
├── version-guard.js (版本控制)
└── formula-parser.js (配方解析引擎)
```

#### 后端架构模式
```javascript
// 服务层架构
backend/
├── server.js (应用入口)
├── routes/ (路由层)
│   ├── custom-colors.js
│   ├── artworks.js
│   └── mont-marte-colors.js
├── services/ (业务逻辑层)
│   ├── ColorService.js
│   ├── ArtworkService.js
│   └── ImageService.js
└── db/ (数据访问层)
    ├── index.js (数据库连接)
    └── migrations.js (数据迁移)
```

## 🔧 技术决策记录 (ADR)

### ADR-001: 前端框架选择
- **决策**: 使用 Vue 3 + Element Plus
- **原因**: 
  - 学习曲线平缓，适合快速开发
  - Element Plus 提供完整的企业级组件
  - 组合式API便于代码组织和复用
- **后果**: 
  - 依赖Vue生态系统
  - Element Plus样式定制需要额外工作

### ADR-002: 数据库选择  
- **决策**: 使用 SQLite 文件数据库
- **原因**:
  - 零配置部署，适合小型应用
  - 数据文件便于备份和迁移
  - 性能满足当前数据规模需求
- **后果**:
  - 并发写入能力有限
  - 不适合分布式部署

### ADR-003: 状态管理策略
- **决策**: 使用组件内状态 + 模块化状态管理
- **原因**:
  - 避免引入Pinia/Vuex的复杂性
  - 各模块状态相对独立
  - localStorage提供持久化
- **后果**:
  - 跨组件状态共享需要手动处理
  - 状态管理逻辑分散

### ADR-004: 样式管理方案
- **决策**: 原生CSS + CSS变量系统
- **原因**:
  - 避免构建工具复杂性
  - CSS变量提供主题化能力
  - 文件加载性能好
- **后果**:
  - 样式文件较大（待重构）
  - 缺少CSS预处理器功能

## 📊 系统性能指标

### 当前性能基准
| 指标类型 | 测试场景 | 目标值 | 当前值 | 状态 |
|---------|---------|--------|--------|------|
| **页面加载** | 首屏渲染 | < 2s | ~1.5s | ✅ 达标 |
| **API响应** | 颜色列表查询 | < 500ms | ~200ms | ✅ 达标 |
| **计算性能** | 查重1000条 | < 2s | ~1.2s | ✅ 达标 |
| **内存使用** | 长时间运行 | < 100MB | ~60MB | ✅ 达标 |

### 性能瓶颈识别
1. **CSS文件过大**: styles.css (1412行) 影响首屏加载
2. **大组件渲染**: artworks.js 复杂度影响交互响应
3. **图片加载**: 缩略图未优化，影响列表滚动

## 🔄 演进规划

### 架构演进路线图

#### Phase 1: 模块化重构 (进行中)
- ✅ 文档体系重构
- 🔄 CSS模块化拆分
- 📋 大组件拆分(artworks.js)
- 📋 通用组件库建设

#### Phase 2: 性能优化 (计划中)
- 📋 图片懒加载和压缩
- 📋 代码分割和按需加载
- 📋 缓存策略优化
- 📋 数据库查询优化

#### Phase 3: 架构升级 (远期)
- 📋 状态管理重构(Pinia)
- 📋 TypeScript 迁移
- 📋 测试框架引入
- 📋 CI/CD 流水线

## 🚨 架构限制和技术债务

### 当前限制
1. **并发处理**: SQLite 写入并发能力有限
2. **扩展性**: 单体应用架构，难以横向扩展
3. **类型安全**: 缺少 TypeScript，类型错误风险
4. **测试覆盖**: 缺少自动化测试框架

### 技术债务清单
| 债务类型 | 具体问题 | 影响程度 | 解决优先级 |
|---------|---------|----------|----------|
| **代码结构** | styles.css 过大 | 中 | 🟡 高 |
| **组件设计** | artworks.js 复杂 | 高 | 🔴 最高 |
| **错误处理** | 异常处理不统一 | 中 | 🟡 中 |
| **性能优化** | 大数据渲染慢 | 低 | 🟢 低 |

## 🔒 安全架构

### 安全措施
1. **输入验证**: 前端和后端双重验证
2. **文件上传**: 类型检查和大小限制
3. **SQL注入**: 使用参数化查询
4. **XSS防护**: 输出转义和CSP策略

### 安全检查清单
- [ ] **输入验证**: 所有用户输入都已验证
- [ ] **文件安全**: 上传文件类型和大小限制
- [ ] **数据库安全**: 查询参数化，避免注入
- [ ] **会话管理**: 暂无用户认证（未来需求）

## 📝 文档维护

### 架构文档更新流程
1. **设计变更**: 重大架构变更需要先更新设计文档
2. **决策记录**: 技术选择记录在ADR中
3. **影响分析**: 评估对现有系统的影响
4. **文档同步**: 代码变更后及时更新文档

### 文档责任
- **架构师**: 负责架构设计和演进规划
- **开发者**: 负责实现细节和技术决策记录  
- **维护者**: 负责文档更新和知识传承

---

**返回**: [📚 主文档](../../README.md) | **上一步**: [⚡ 功能文档](../features/) | **相关**: [🛠️ 开发文档](../development/)